<html>
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.15.1/d3.min.js"></script>


    <script type="text/javascript">
    var nested;

    d3.csv('data/organigramas.csv')
                .then(function(imported) {
                    nested = d3.nest()
                          .key(function(d) { return d.Camara; })
                          .key(function(d) { return d.Seccion; })
                          .entries(imported);
                    
                });
      google.charts.load('current', {packages:["orgchart"]});
      google.charts.setOnLoadCallback(dibujaGraficos);

      function dibujaGraficos() {
        nested.forEach(function(d){
                d3.select("body").append("div").attr("id",d.key)
                                .append("h2").attr("class","subtitle").html(d.key);

                d.values.forEach(function(e){
                            d3.select("#"+d.key)
                            .append("h3").attr("class","subtitle").html(e.key)
                            .append("div").attr("id",e.values[0].idSlug);
                        ;
                        var tablaContent = e.values.map(function(f){
                            return [{'v':f.idSlug,'f':f.area+":<br><b>"+f.titular+"</b>"},f['depende de'],f.direccion+" "+f.telefono];
                          })
                             drawChart(tablaContent,e.values[0].idSlug)
                       })                                
                 })
      }

      function drawChart(tablaContent,id) {
        var tabla = new google.visualization.DataTable();
        tabla.addColumn('string', 'Name');
        tabla.addColumn('string', 'Manager');
        tabla.addColumn('string', 'ToolTip');

        // For each orgchart box, provide the name, manager, and tooltip to show.
        tabla.addRows(tablaContent);
        // Create the chart.
        var chart = new google.visualization.OrgChart(document.getElementById(id));
        // Draw the chart, setting the allowHtml option to true for the tooltips.
        chart.draw(tabla, {'allowHtml':true,'size':'small'});
      }
   </script>
    </head>
  <body>
    
  </body>
</html>
